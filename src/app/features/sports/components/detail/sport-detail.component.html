@if (sport(); as s) {
  <div class="sport-detail">
    <div class="sport-detail__header">
      <div class="sport-detail__header-left">
        <button
          tuiButton
          iconStart="@tui.chevron-left"
          appearance="flat"
          (click)="navigateBack()">Back</button>
        <h1 class="sport-detail__title">{{ s.title | uppercase }}</h1>
      </div>
      <div class="sport-detail__header-right">
        <div class="sport-detail__menu-container" tuiActiveZone (tuiActiveZoneChange)="onMenuActiveZoneChange($event)">
          <button
            type="button"
            tuiIconButton
            (click)="toggleMenu()">
            <tui-icon icon="@tui.ellipsis" />
          </button>
          @if (menuOpen()) {
            <div class="sport-detail__menu-dropdown">
              <button
                type="button"
                class="sport-detail__menu-item"
                (click)="navigateToEdit(); closeMenu()">
                <tui-icon icon="@tui.edit" class="sport-detail__menu-icon" />
                Edit
              </button>
              <button
                type="button"
                class="sport-detail__menu-item sport-detail__menu-item--danger"
                (click)="deleteSport(); closeMenu()">
                <tui-icon icon="@tui.trash" class="sport-detail__menu-icon" />
                Delete
              </button>
            </div>
          }
        </div>
      </div>
    </div>

    <div class="sport-detail__subnav">
      <nav class="sport-detail__tabs">
        <button
          class="sport-detail__tab"
          [class.sport-detail__tab--active]="activeTab === 'tournaments'"
          (click)="onTabChange('tournaments')">Tournaments</button>
        <button
          class="sport-detail__tab"
          [class.sport-detail__tab--active]="activeTab === 'teams'"
          (click)="onTabChange('teams')">Teams</button>
        <button
          class="sport-detail__tab"
          [class.sport-detail__tab--active]="activeTab === 'players'"
          (click)="onTabChange('players')">Players</button>
        <button
          class="sport-detail__tab"
          [class.sport-detail__tab--active]="activeTab === 'positions'"
          (click)="onTabChange('positions')">Positions</button>
      </nav>

      <div class="sport-detail__season-selector">
        <tui-textfield tuiChevron tuiTextfieldSize="s">
          <input
            placeholder="Select Season"
            tuiSelect
            [(ngModel)]="selectedSeasonYear"
            (ngModelChange)="onSeasonChange($event)" />
          <tui-data-list *tuiTextfieldDropdown size="l">
            @for (year of seasonYears(); track year) {
              <button new tuiOption type="button" [value]="year" class="sport-detail__season-option">{{ year }}</button>
            }
          </tui-data-list>
        </tui-textfield>
      </div>
    </div>

    @if (activeTab === 'tournaments') {
      <div class="sport-detail__tournaments">
        @if (!selectedSeasonYear()) {
          <p class="sport-detail__empty-message">Please select a season to view tournaments</p>
        } @else {
          <div class="sport-detail__search-container">
            <tui-textfield iconStart="@tui.search">
              <label tuiLabel>Search tournaments</label>
              <input
                placeholder="Search by name or description..."
                tuiTextfield
                [value]="searchQuery()"
                (input)="onSearchChange($any($event.target).value)" />
            </tui-textfield>
            @if (searchQuery()) {
              <button
                type="button"
                tuiButton
                appearance="flat"
                icon="@tui.close"
                size="s"
                (click)="clearSearch()"
                class="sport-detail__search-clear">
                <tui-icon [icon]="'@tui.close'" />
              </button>
            }
          </div>

          @if (tournaments().length === 0) {
            <p class="sport-detail__empty-message">No tournaments found for this season</p>
          } @else {
            <div class="sport-detail__tournament-list">
              @for (tournament of paginatedTournaments(); track tournament.id) {
                <button
                  class="sport-detail__tournament-card"
                  tuiCardLarge
                  tuiCell="l"
                  (click)="navigateToTournamentDetail(tournament.id)">
                  <div class="sport-detail__tournament-icon">
                    <tui-avatar size="l" class="sport-detail__tournament-avatar">
                      <tui-icon icon="@tui.trophy" />
                    </tui-avatar>
                  </div>
                  <div class="sport-detail__tournament-content">
                    <h3 class="sport-detail__tournament-title">{{ tournament.title }}</h3>
                    @if (tournament.description) {
                      <p class="sport-detail__tournament-description">{{ tournament.description }}</p>
                    }
                  </div>
                </button>
              }
            </div>

            @if (totalPages() > 1) {
              <div class="sport-detail__pagination-wrapper">
                <div class="sport-detail__items-per-page">
                  <span>Items per page:</span>
                  @for (option of itemsPerPageOptions; track option) {
                    <button
                      type="button"
                      class="sport-detail__items-option"
                      [class.sport-detail__items-option--active]="itemsPerPage() === option"
                      (click)="onItemsPerPageChange(option)">
                      {{ option }}
                    </button>
                  }
                </div>
                <div class="sport-detail__pagination">
                  <tui-pagination
                    [length]="totalPages()"
                    [index]="currentPage() - 1"
                    (indexChange)="onPageChange($event)" />
                </div>
              </div>
            }
          }
        }
      </div>
    } @else if (activeTab === 'teams') {
      <div class="sport-detail__teams">
        <div class="sport-detail__search-container">
          <tui-textfield iconStart="@tui.search">
            <label tuiLabel>Search teams</label>
            <input
              placeholder="Search by name or city..."
              tuiTextfield
              [value]="teamSearchQuery()"
              (input)="onTeamSearchChange($any($event.target).value)" />
          </tui-textfield>
          @if (teamSearchQuery()) {
            <button
              type="button"
              tuiButton
              appearance="flat"
              icon="@tui.close"
              size="s"
              (click)="clearTeamSearch()"
              class="sport-detail__search-clear">
              <tui-icon [icon]="'@tui.close'" />
            </button>
          }
        </div>

        @if (teamsLoading()) {
          <div class="sport-detail__loading">Loading teams...</div>
        } @else if (teamsError()) {
          <div class="sport-detail__error">{{ teamsError() }}</div>
        } @else if (paginatedTeams().length === 0) {
          <p class="sport-detail__empty-message">No teams found for this sport</p>
        } @else {
          <div class="sport-detail__team-list">
            @for (team of paginatedTeams(); track team.id) {
              <button
                class="sport-detail__team-card"
                tuiCardLarge
                tuiCell="l"
                (click)="navigateToTeamDetail(team.id)">
                <div class="sport-detail__team-icon">
                  @if (teamLogoUrl(team); as logoUrl) {
                    <img [src]="logoUrl" [alt]="team.title" class="sport-detail__team-logo" />
                  } @else {
                    <tui-avatar size="l" class="sport-detail__team-avatar">
                      <tui-icon icon="@tui.users" />
                    </tui-avatar>
                  }
                </div>
                <div class="sport-detail__team-content">
                  <h3 class="sport-detail__team-title">{{ team.title }}</h3>
                  @if (team.city) {
                    <p class="sport-detail__team-city">{{ team.city }}</p>
                  }
                </div>
              </button>
            }
          </div>

          @if (teamsTotalPagesComputed() > 1) {
            <div class="sport-detail__pagination-wrapper">
              <div class="sport-detail__items-per-page">
                <span>Items per page:</span>
                @for (option of itemsPerPageOptions; track option) {
                  <button
                    type="button"
                    class="sport-detail__items-option"
                    [class.sport-detail__items-option--active]="teamsItemsPerPage() === option"
                    (click)="onTeamsItemsPerPageChange(option)">
                    {{ option }}
                  </button>
                }
              </div>
              <div class="sport-detail__pagination">
                <tui-pagination
                  [length]="teamsTotalPagesComputed()"
                  [index]="teamsCurrentPage() - 1"
                  (indexChange)="onTeamsPageChange($event)" />
              </div>
            </div>
          }
        }
      </div>
    } @else if (activeTab === 'positions') {
      <div class="sport-detail__positions">
        <div class="sport-detail__header-with-actions">
          <div class="sport-detail__search-container">
            <tui-textfield iconStart="@tui.search">
              <label tuiLabel>Search positions</label>
              <input
                placeholder="Search by title..."
                tuiTextfield
                [value]="positionSearchQuery()"
                (input)="onPositionSearchChange($any($event.target).value)" />
            </tui-textfield>
            @if (positionSearchQuery()) {
              <button
                type="button"
                tuiButton
                appearance="flat"
                icon="@tui.close"
                size="s"
                (click)="clearPositionSearch()"
                class="sport-detail__search-clear">
                <tui-icon [icon]="'@tui.close'" />
              </button>
            }
          </div>
          <button
            type="button"
            tuiButton
            (click)="openPositionForm()"
            class="sport-detail__add-button">
            <tui-icon icon="@tui.plus" />
            Add Position
          </button>
        </div>

        @if (positionsLoading()) {
          <div class="sport-detail__loading">Loading positions...</div>
        } @else if (positionsError()) {
          <div class="sport-detail__error">{{ positionsError() }}</div>
        } @else if (paginatedPositions().length === 0) {
          <p class="sport-detail__empty-message">No positions found for this sport</p>
        } @else {
          <div class="sport-detail__position-list">
            @for (position of paginatedPositions(); track position.id) {
              <div class="sport-detail__position-card">
                <div class="sport-detail__position-content">
                  <h3 class="sport-detail__position-title">{{ position.title }}</h3>
                </div>
                <div class="sport-detail__position-actions">
                  <button
                    type="button"
                    tuiButton
                    appearance="flat"
                    icon="@tui.edit"
                    size="s"
                    (click)="openPositionForm(position)"
                    class="sport-detail__action-button">
                    <tui-icon icon="@tui.edit" />
                  </button>
                  <button
                    type="button"
                    tuiButton
                    appearance="flat"
                    icon="@tui.trash"
                    size="s"
                    (click)="deletePosition(position)"
                    class="sport-detail__action-button sport-detail__action-button--danger">
                    <tui-icon icon="@tui.trash" />
                  </button>
                </div>
              </div>
            }
          </div>

          @if (positionsTotalPagesComputed() > 1) {
            <div class="sport-detail__pagination-wrapper">
              <div class="sport-detail__items-per-page">
                <span>Items per page:</span>
                @for (option of itemsPerPageOptions; track option) {
                  <button
                    type="button"
                    class="sport-detail__items-option"
                    [class.sport-detail__items-option--active]="positionsItemsPerPage() === option"
                    (click)="onPositionsItemsPerPageChange(option)">
                    {{ option }}
                  </button>
                }
              </div>
              <div class="sport-detail__pagination">
                <tui-pagination
                  [length]="positionsTotalPagesComputed()"
                  [index]="positionsCurrentPage() - 1"
                  (indexChange)="onPositionsPageChange($event)" />
              </div>
            </div>
          }
        }
      </div>
    }

    @if (positionFormOpen()) {
      <div class="sport-detail__modal-overlay">
        <div class="sport-detail__modal">
          <div class="sport-detail__modal-header">
            <h2>{{ editingPosition() ? 'Edit Position' : 'Add Position' }}</h2>
            <button
              type="button"
              tuiButton
              appearance="flat"
              icon="@tui.close"
              (click)="closePositionForm()">
              <tui-icon icon="@tui.close" />
            </button>
          </div>
          <div class="sport-detail__modal-body">
            <tui-textfield>
              <label tuiLabel>Title</label>
              <input
                type="text"
                tuiTextfield
                [(ngModel)]="positionTitle"
                placeholder="Position title" />
            </tui-textfield>
          </div>
          <div class="sport-detail__modal-footer">
            <button
              type="button"
              tuiButton
              appearance="ghost"
              (click)="closePositionForm()">
              Cancel
            </button>
            <button
              type="button"
              tuiButton
              appearance="primary"
              (click)="savePosition()">
              {{ editingPosition() ? 'Update' : 'Create' }}
            </button>
          </div>
        </div>
      </div>
    }
  </div>
} @else {
  <div class="sport-detail__not-found">Sport not found</div>
}

<app-collapsible-section title="Time Controls" sectionKey="scoreboard-time">
  <ng-template>
    <div class="time-forms">
      <!-- Game Clock Section -->
      @if (showGameClock()) {
        <div class="time-section game-clock-section">
        <h4 class="section-title">Game Clock</h4>

        <!-- Quarter Length at top -->
        <div class="max-time-setting">
          <span class="setting-label">Quarter Length (min)</span>
          <div class="max-time-row">
            <tui-textfield [tuiTextfieldCleaner]="false" tuiTextfieldSize="m" class="time-input">
              <input
                tuiInputNumber
                [ngModel]="currentMaxMinutes()"
                [min]="1"
                [max]="20"
                [step]="1"
                [disabled]="inputsDisabled()"
                (ngModelChange)="onMaxMinutesChange($event)"
              />
            </tui-textfield>
            <button
              tuiButton
              type="button"
              appearance="primary"
              size="m"
              class="save-button"
              (click)="onSaveQuarterLength()"
              [disabled]="!gameClockReady() || inputsDisabled()"
            >
              Save
            </button>
          </div>
        </div>

        <div class="clock-display">
          <span class="clock-value">{{ gameClockDisplay() }}</span>
          <span class="clock-status" [class.running]="gameClockRunning()">
            {{ gameClockRunning() ? 'Running' : 'Stopped' }}
          </span>
        </div>

        <div class="clock-controls">
          @if (gameClockRunning()) {
            <button
              tuiButton
              type="button"
              appearance="primary"
              size="m"
              (click)="onGameClockPause()"
              [disabled]="!gameClockReady() || gameClockLocked()"
            >
              <tui-icon icon="@tui.pause" />
              Pause
            </button>
          } @else {
            <button
              tuiButton
              type="button"
              appearance="primary"
              size="m"
              (click)="onGameClockStart()"
              [disabled]="!gameClockReady() || gameClockLocked()"
            >
              <tui-icon icon="@tui.play" />
              Start
            </button>
          }

          <button
            tuiButton
            type="button"
            appearance="secondary"
            size="m"
            (click)="onGameClockReset()"
            [disabled]="!gameClockReady() || gameClockRunning() || gameClockLocked()"
          >
            <tui-icon icon="@tui.refresh-cw" />
            Reset
          </button>
        </div>

        <div class="manual-time-entry">
          <span class="setting-label">Set Time</span>
          <div class="time-inputs-compact">
            <div class="time-input-group">
              <span class="input-label">Min</span>
              <tui-textfield [tuiTextfieldCleaner]="false" tuiTextfieldSize="m" class="time-input">
                <input
                  tuiInputNumber
                  [ngModel]="manualMinutes()"
                  [min]="0"
                  [max]="99"
                  [step]="1"
                  [disabled]="inputsDisabled()"
                  (ngModelChange)="onManualMinutesChange($event)"
                  (focus)="onInputFocus()"
                  (blur)="onInputBlur()"
                />
              </tui-textfield>
            </div>
            <div class="time-input-group">
              <span class="input-label">Sec</span>
              <tui-textfield [tuiTextfieldCleaner]="false" tuiTextfieldSize="m" class="time-input">
                <input
                  tuiInputNumber
                  [ngModel]="manualSeconds()"
                  [min]="0"
                  [max]="59"
                  [step]="1"
                  [disabled]="inputsDisabled()"
                  (ngModelChange)="onManualSecondsChange($event)"
                  (focus)="onInputFocus()"
                  (blur)="onInputBlur()"
                />
              </tui-textfield>
            </div>
            <button
              tuiButton
              type="button"
              appearance="primary"
              size="m"
              class="save-button"
              (pointerdown)="onSetGameClock()"
              [disabled]="!gameClockReady() || inputsDisabled()"
            >
              Set
            </button>
          </div>
          </div>
        </div>
      }

      @if (showPlayClock()) {
        <!-- Play Clock Section -->
        <div class="time-section play-clock-section">
          <h4 class="section-title">Play Clock</h4>

          <div class="clock-display play-clock-display" [class.warning]="playClockWarning()">
            <span class="clock-value">{{ playClockDisplay() ?? '' }}</span>
            <span class="clock-status" [class.running]="playClockRunning()">
              {{ playClockRunning() ? 'Running' : 'Stopped' }}
            </span>
          </div>

          <div class="play-clock-buttons">
            <button
              tuiButton
              type="button"
              appearance="primary"
              size="m"
              (click)="onPlayClockStart(40)"
              [disabled]="!playClockReady() || playClockRunning() || playClockLocked()"
            >
              40 sec
            </button>

            <button
              tuiButton
              type="button"
              appearance="primary"
              size="m"
              (click)="onPlayClockStart(25)"
              [disabled]="!playClockReady() || playClockRunning() || playClockLocked()"
            >
              25 sec
            </button>

            <button
              tuiButton
              type="button"
              appearance="secondary"
              size="m"
              (click)="onPlayClockReset()"
              [disabled]="!playClockReady() || playClockLocked()"
            >
              Reset
            </button>
          </div>
        </div>
      }
    </div>
  </ng-template>
</app-collapsible-section>

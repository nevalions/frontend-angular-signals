<app-collapsible-section title="Down & Distance" sectionKey="scoreboard-down-distance">
  <ng-template>
    <div class="down-distance-forms">
      <!-- Down & Distance Panel -->
      <div class="down-distance-panel">
        <!-- Current Down & Distance Display -->
        <div class="current-values-wrapper">
          <tui-badged-content>
            @if (hasChanges()) {
              <tui-badge-notification tuiSlot="top" appearance="negative">!</tui-badge-notification>
            }
            <div class="current-values">
              <span class="values">{{ currentDownDistance() }}</span>
            </div>
          </tui-badged-content>
        </div>

        <!-- Down Selection -->
        <div class="form-section">
          <label class="section-label">Down</label>
          <div class="down-buttons">
            @for (option of downOptions(); track option.value) {
              <button
                tuiButton
                type="button"
                [appearance]="isDownSelected(option.value) ? 'primary' : 'secondary'"
                size="m"
                (click)="onDownSelect(option.value)"
              >
                {{ option.label }}
              </button>
            }

            <!-- Flag Toggle Button -->
            <button
              tuiButton
              type="button"
              [appearance]="isFlagActive() ? 'accent' : 'outline'"
              size="m"
              class="flag-toggle-button"
              [class.flag-active]="isFlagActive()"
              (click)="onFlagToggle()"
            >
              <span class="flag-icon">&#x2691;&#xFE0E;</span>
            </button>
          </div>
        </div>

        <!-- Distance Select & Save Row -->
        <div class="distance-save-row">
          <div class="distance-select-wrapper">
            <tui-textfield tuiChevron [tuiTextfieldCleaner]="false" [stringify]="distanceStringify">
              <label tuiLabel>Distance</label>
              <input
                tuiSelect
                [ngModel]="pendingDistance()"
                (ngModelChange)="pendingDistance.set($event)"
                placeholder="Select distance"
              />
              <tui-data-list *tuiTextfieldDropdown size="l">
                @for (opt of distanceOptions(); track opt.value) {
                  <button new tuiOption type="button" [value]="opt.value">{{ opt.label }}</button>
                }
              </tui-data-list>
            </tui-textfield>
          </div>

          <!-- Save Button -->
          <button
            tuiButton
            type="button"
            appearance="primary"
            size="l"
            class="save-button"
            [disabled]="!hasChanges()"
            (click)="onSave()"
          >
            Save
          </button>
        </div>

        <!-- Quick Distance Buttons -->
        <div class="distance-presets">
          <button
            tuiButton
            type="button"
            appearance="outline"
            size="s"
            (click)="pendingDistance.set('INCH')"
          >
            {{ quickPresetInchLabel() }}
          </button>
          <button
            tuiButton
            type="button"
            appearance="outline"
            size="s"
            (click)="pendingDistance.set('GOAL')"
          >
            {{ quickPresetGoalLabel() }}
          </button>
          <button
            tuiButton
            type="button"
            appearance="outline"
            size="s"
            (click)="onDownSelect('1st'); pendingDistance.set('10')"
          >
            {{ quickPresetOneTenLabel() }}
          </button>
        </div>

        <!-- Special Game States -->
        <div class="form-section">
          <label class="section-label">Special States</label>
          <div class="special-state-buttons">
            @for (opt of specialStateOptions(); track opt.value) {
              <button
                tuiButton
                type="button"
                [appearance]="isSpecialStateSelected(opt.value) ? 'primary' : 'secondary'"
                size="m"
                (click)="onSpecialStateSelect(opt.value)"
              >
                {{ opt.label }}
              </button>
            }
          </div>
        </div>
      </div>
    </div>
  </ng-template>
</app-collapsible-section>

<div class="scoreboard-admin-page">
  <header class="page-header">
    <div class="header-left">
      <button tuiButton type="button" appearance="secondary" size="s" (click)="navigateBack()">
        <tui-icon icon="@tui.arrow-left" />
        Back
      </button>
      <h1 class="page-title">Scoreboard Admin</h1>
    </div>
    <div class="header-right">
      <app-connection-indicator [showLabel]="true" />
      <button tuiButton type="button" appearance="primary" size="s" (click)="openHdView()">
        <tui-icon icon="@tui.external-link" />
        Open HD View
      </button>
    </div>
  </header>

  @if (loading()) {
    <div class="loading-state">
      <p>Loading scoreboard data...</p>
    </div>
  } @else if (error()) {
    <div class="error-state">
      <p>{{ error() }}</p>
      <button tuiButton appearance="secondary" (click)="navigateBack()">Go Back</button>
    </div>
  } @else {
    <div class="admin-content">
      <!-- Scoreboard Preview -->
      <section class="preview-section">
        <h2 class="section-title">Preview</h2>
        <app-scoreboard-display
          [data]="data()"
          [gameClock]="gameClockSeconds()"
          [playClock]="playClockDisplay()"
          displayClass="scoreboard"
        />
      </section>

      <!-- Admin Forms -->
      <section class="forms-section">
        <div class="forms-header">
          <button
            tuiButton
            type="button"
            appearance="secondary"
            size="s"
            (click)="toggleHideAllForms()"
          >
            <tui-icon [icon]="hideAllForms() ? '@tui.eye' : '@tui.eye-off'" />
            {{ hideAllForms() ? 'Expand All' : 'Collapse All' }}
          </button>
        </div>

        <div class="forms-grid">
          <app-down-distance-forms
            [matchData]="data()?.match_data ?? null"
            [scoreboard]="scoreboard()"
            (downDistanceChange)="onDownDistanceChange($event)"
            (flagToggle)="onFlagToggle($event)"
          />

          <app-score-forms
            [matchData]="data()?.match_data ?? null"
            [teamColorA]="data()?.teams?.team_a?.team_color ?? '#ffffff'"
            [teamColorB]="data()?.teams?.team_b?.team_color ?? '#ffffff'"
            (scoreChange)="onScoreChange($event)"
            (timeoutChange)="onTimeoutChange($event)"
            (qtrChange)="onQtrChange($event)"
          />

          <app-time-forms
            [gameClock]="gameClockWithPredictedValue()"
            [playClock]="playClockWithPredictedValue()"
            [gameClockLocked]="gameClockLocked()"
            [playClockLocked]="playClockLocked()"
            (gameClockAction)="onGameClockAction($event)"
            (playClockAction)="onPlayClockAction($event)"
          />

          <app-scoreboard-settings-forms
            [scoreboard]="scoreboard()"
            (scoreboardChange)="onScoreboardSettingsChange($event)"
          />

          <app-events-forms
            [matchStats]="matchStats()"
            [players]="data()?.players ?? []"
            (eventCreate)="onEventCreate($event)"
            (eventUpdate)="onEventUpdate($event)"
            (eventDelete)="onEventDelete($event)"
          />
        </div>
      </section>
    </div>
  }
</div>

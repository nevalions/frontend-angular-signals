<div class="preset-edit">
  <header class="preset-edit__header">
    <h1 class="preset-edit__title">Edit Preset</h1>
    <div class="preset-edit__actions">
      <button tuiButton type="button" appearance="flat" (click)="navigateToDetail()">
        Cancel
      </button>
      <button tuiButton type="button" appearance="primary" (click)="onSubmit()" [disabled]="presetForm.invalid || customPeriodLabelsInvalid() || customMinTimeModeInvalid() || quickScoreDeltasInvalid() || loading()">
        Save Changes
      </button>
    </div>
  </header>

  @if (loading()) {
    <div class="preset-edit__loading">
      <tui-loader size="l" />
    </div>
  } @else {
    <form [formGroup]="presetForm" class="preset-edit__form">
      <div class="preset-edit__section">
        <h3 class="preset-edit__section-title">Basic Information</h3>
      <div class="preset-edit__field">
        <label class="preset-edit__label" for="title">Title *</label>
        <input
          id="title"
          type="text"
          placeholder="Enter preset title"
          formControlName="title"
          class="preset-edit__input"
        />
      </div>
      </div>

      <div class="preset-edit__section">
        <h3 class="preset-edit__section-title">Gameclock Configuration</h3>
      <div class="preset-edit__field">
        <label class="preset-edit__label" for="gameclock_max">Max Gameclock (seconds)</label>
        <input
          id="gameclock_max"
          type="number"
          placeholder="720"
          formControlName="gameclock_max"
          class="preset-edit__input"
        />
      </div>
      <div class="preset-edit__field">
        <label class="preset-edit__label" for="initial_time_mode">Initial Time Mode</label>
        <select
          id="initial_time_mode"
          formControlName="initial_time_mode"
          class="preset-edit__select"
        >
          @for (option of initialTimeModeOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>
      <div class="preset-edit__field">
        <label class="preset-edit__label" for="period_clock_variant">Period Clock Behavior</label>
        <select
          id="period_clock_variant"
          formControlName="period_clock_variant"
          class="preset-edit__select"
        >
          @for (option of periodClockVariantOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
        <p class="preset-edit__hint">Soccer example: cumulative keeps half 2 running from 45 to 90 instead of resetting to 45.</p>
      </div>
      @if (isCustomMinTimeMode()) {
        <div class="preset-edit__field">
          <label class="preset-edit__label" for="initial_time_min_seconds">Min Gameclock (seconds) *</label>
          <input
            id="initial_time_min_seconds"
            type="number"
            placeholder="0"
            formControlName="initial_time_min_seconds"
            class="preset-edit__input"
          />
          @if (customMinTimeModeInvalid()) {
            <p class="preset-edit__error">Min gameclock is required and must be >= 0 when Initial Time Mode is Custom Min.</p>
          }
        </div>
      }
      <div class="preset-edit__field">
        <label class="preset-edit__label" for="direction">Clock Direction</label>
        <select
          id="direction"
          formControlName="direction"
          class="preset-edit__select"
        >
          @for (option of directionOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>
      <div class="preset-edit__field">
        <label class="preset-edit__label" for="on_stop_behavior">On Stop Behavior</label>
        <select
          id="on_stop_behavior"
          formControlName="on_stop_behavior"
          class="preset-edit__select"
        >
          @for (option of onStopBehaviorOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
      </div>
      </div>

      <div class="preset-edit__section">
        <h3 class="preset-edit__section-title">Scoreboard Configuration</h3>
        <div class="preset-edit__checkboxes">
          <label class="preset-edit__checkbox">
            <input
              type="checkbox"
              tuiCheckbox
              formControlName="is_qtr"
            />
            <span>Show Quarter Indicator</span>
          </label>
          <label class="preset-edit__checkbox">
            <input
              type="checkbox"
              tuiCheckbox
              formControlName="is_time"
            />
            <span>Show Time Display</span>
          </label>
          <label class="preset-edit__checkbox">
            <input
              type="checkbox"
              tuiCheckbox
              formControlName="is_playclock"
            />
            <span>Show Playclock</span>
          </label>
          <label class="preset-edit__checkbox">
            <input
              type="checkbox"
              tuiCheckbox
              formControlName="is_downdistance"
            />
            <span>Show Down & Distance</span>
          </label>
        </div>
      </div>

      <div class="preset-edit__section">
        <h3 class="preset-edit__section-title">Capabilities</h3>
        <div class="preset-edit__checkboxes">
          <label class="preset-edit__checkbox">
            <input
              type="checkbox"
              tuiCheckbox
              formControlName="has_timeouts"
            />
            <span>Enable Timeouts</span>
          </label>
          <label class="preset-edit__checkbox">
            <input
              type="checkbox"
              tuiCheckbox
              formControlName="has_playclock"
            />
            <span>Enable Playclock</span>
          </label>
        </div>
      </div>

      <div class="preset-edit__section">
        <h3 class="preset-edit__section-title">Period Configuration</h3>
        <div class="preset-edit__field">
          <label class="preset-edit__label" for="period_mode">Period Mode</label>
          <select
            id="period_mode"
            formControlName="period_mode"
            class="preset-edit__select"
          >
            @for (option of periodModeOptions; track option.value) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </div>
        <div class="preset-edit__field">
          <label class="preset-edit__label" for="period_count">Period Count</label>
          <input
            id="period_count"
            type="number"
            min="1"
            max="99"
            placeholder="4"
            formControlName="period_count"
            class="preset-edit__input"
          />
        </div>

        @if (isCustomPeriodMode()) {
          <div class="preset-edit__field">
            <label class="preset-edit__label" for="period_labels_input">Custom Period Labels</label>
            <input
              id="period_labels_input"
              type="text"
              placeholder="period.leg_1, period.leg_2"
              formControlName="period_labels_input"
              class="preset-edit__input"
            />
            <p class="preset-edit__hint">Comma separated machine labels (lowercase letters/numbers with '.', '_' or '-').</p>
            @if (customPeriodLabelsInvalid()) {
              <p class="preset-edit__error">Custom labels contain invalid keys.</p>
            }
          </div>
        }
      </div>

      <div class="preset-edit__section">
        <h3 class="preset-edit__section-title">Playclock Configuration</h3>
        <div class="preset-edit__field">
          <label class="preset-edit__label" for="default_playclock_seconds">Default Playclock (seconds)</label>
          <input
            id="default_playclock_seconds"
            type="number"
            placeholder="40"
            formControlName="default_playclock_seconds"
            class="preset-edit__input"
          />
        </div>
      </div>

      <div class="preset-edit__section">
        <h3 class="preset-edit__section-title">Quick Score Deltas</h3>
        <div class="preset-edit__field">
          <label class="preset-edit__label" for="quick_score_deltas_input">Value-only quick score buttons</label>
          <input
            id="quick_score_deltas_input"
            type="text"
            placeholder="6,3,2,1,-1"
            formControlName="quick_score_deltas_input"
            class="preset-edit__input"
          />
          <p class="preset-edit__hint">Ordered comma-separated integers. Max 10 values, no 0, range -100 to 100.</p>
          @if (quickScoreDeltasValidationError(); as quickDeltasError) {
            <p class="preset-edit__error">{{ quickDeltasError }}</p>
          }
        </div>
      </div>
    </form>
  }
</div>

<div class="users-tab">
  <div class="users-tab__header">
    <div class="users-tab__search-container">
      <tui-textfield iconStart="@tui.search" class="users-tab__search-input">
        <label tuiLabel>Search users</label>
        <input
          placeholder="Search by name or email..."
          tuiTextfield
          [value]="userSearchQuery()"
          (input)="onUserSearchChange($any($event.target).value)" />
      </tui-textfield>
      @if (userSearchQuery()) {
        <button
          type="button"
          tuiButton
          appearance="flat"
          size="s"
          (click)="clearUserSearch()"
          class="users-tab__search-clear">
          <tui-icon icon="@tui.close" />
        </button>
      }
      <tui-textfield tuiChevron [stringify]="stringifyOnlineFilter" class="users-tab__filter-select">
        <label tuiLabel>Filter by status</label>
        <input
          placeholder="All"
          tuiSelect
          [(ngModel)]="selectedOnlineFilter" />
        <tui-data-list *tuiTextfieldDropdown>
          @for (option of onlineFilterOptions; track option.value) {
            <button new tuiOption type="button" [value]="option.value">
              {{ option.label }}
            </button>
          }
        </tui-data-list>
      </tui-textfield>
    </div>
    <button
      type="button"
      tuiButton
      appearance="flat"
      iconStart="@tui.plus"
      (click)="navigateToAddUser()"
      class="users-tab__add-button">
      Add User
    </button>
  </div>

  <div class="users-tab__sort-bar">
    <div class="users-tab__sort-container">
      <label class="users-tab__sort-label">Sort by:</label>
      <div class="users-tab__sort-buttons">
        <button
          type="button"
          tuiButton
          [appearance]="usersSortBy() === 'username' ? 'primary' : 'outline'"
          size="s"
          (click)="onSortByClick('username')"
          class="users-tab__sort-button">
          Name
          @if (usersSortBy() === 'username') {
            <tui-icon [icon]="usersSortAscending() ? '@tui.chevron-up' : '@tui.chevron-down'" />
          }
        </button>
        <button
          type="button"
          tuiButton
          [appearance]="usersSortBy() === 'email' ? 'primary' : 'outline'"
          size="s"
          (click)="onSortByClick('email')"
          class="users-tab__sort-button">
          Email
          @if (usersSortBy() === 'email') {
            <tui-icon [icon]="usersSortAscending() ? '@tui.chevron-up' : '@tui.chevron-down'" />
          }
        </button>
        <button
          type="button"
          tuiButton
          [appearance]="usersSortBy() === 'online' ? 'primary' : 'outline'"
          size="s"
          (click)="onSortByClick('online')"
          class="users-tab__sort-button">
          Online Status
          @if (usersSortBy() === 'online') {
            <tui-icon [icon]="usersSortAscending() ? '@tui.chevron-up' : '@tui.chevron-down'" />
          }
        </button>
      </div>
    </div>
  </div>

  @if (usersLoading()) {
    <div class="users-tab__loading">Loading users...</div>
  } @else if (usersError()) {
    <div class="users-tab__error">{{ usersError() }}</div>
  } @else if (users().length === 0) {
    <p class="users-tab__empty-message">No users found</p>
  } @else {
    <div class="users-tab__user-list">
      @for (user of users(); track user.id) {
        <app-user-card
          [user]="user"
          [showOnlineStatus]="true"
          [showAccountStatus]="true"
          [showMemberSince]="true"
          [showLastOnline]="true"
          (cardClick)="navigateToUserDetail(user.id)" />
      }
    </div>
  }

  @if (apiTotalPages > 1) {
    <div class="users-tab__pagination-wrapper">
      <div class="users-tab__items-per-page">
        <span>Items per page:</span>
        @for (option of itemsPerPageOptions; track option) {
          <button
            type="button"
            tuiButton
            [appearance]="usersItemsPerPage() === option ? 'primary' : 'outline'"
            size="xs"
            class="users-tab__items-option"
            (click)="onUsersItemsPerPageChange(option)">
            {{ option }}
          </button>
        }
      </div>
      <div class="users-tab__pagination">
        <tui-pagination
          [length]="apiTotalPages"
          [index]="usersCurrentPage() - 1"
          (indexChange)="onUsersPageChange($any($event))" />
      </div>
    </div>
  }
</div>

<div class="person-list">
  <div class="header">
    <h1>Persons</h1>
    <button
      type="button"
      tuiButton
      (click)="navigateToCreate()"
      class="add-button"
    >
      Add Person
    </button>
    <div class="sort-controls">
      <button
        type="button"
        appearance="flat"
        size="s"
        tuiButton
        class="sort-button"
        (click)="toggleSort('first_name')"
      >
        First Name
        <tui-icon
          class="sort-icon"
          [icon]="getSortIcon('first_name')"
          [class.active]="sortBy() === 'first_name'"
        />
      </button>
      <button
        type="button"
        appearance="flat"
        size="s"
        tuiButton
        class="sort-button"
        (click)="toggleSort('second_name')"
      >
        Second Name
        <tui-icon
          class="sort-icon"
          [icon]="getSortIcon('second_name')"
          [class.active]="sortBy() === 'second_name'"
        />
      </button>
    </div>
  </div>

  <div class="search-container">
    <tui-textfield iconStart="@tui.search">
      <label tuiLabel>Search persons</label>
      <input placeholder="Search by name..." tuiTextfield [formControl]="searchControl" />
    </tui-textfield>
      @if (searchControl.value) {
        <button
          type="button"
          tuiButton
          appearance="flat"
          icon="@tui.close"
          size="s"
          (click)="clearSearch()"
          class="search-clear-button"
        >
          <tui-icon [icon]="'@tui.close'" />
        </button>
      }
  </div>

  @if (loading()) {
    <div class="loading">
      <tui-loader size="l" />
    </div>
  } @else if (error()) {
    <div class="error">Error loading persons</div>
  } @else if (persons().length === 0) {
    <div class="empty">No persons found</div>
  } @else {
    <div class="persons-list">
      @for (person of persons(); track person.id) {
        <div class="person-card" tuiAppearance="neutral" tuiCardLarge tuiCell="l" (click)="navigateToPersonDetail(person.id)">
          <tui-avatar size="l" [src]="photoUrl(person)" [round]="true">
            @if (!person.person_photo_url) {
              {{ person.first_name[0].toUpperCase() }}{{ person.second_name[0].toUpperCase() }}
            }
          </tui-avatar>
          <div class="person-name-container">
            <strong class="second-name">{{ capitalizeName(person.second_name) }}</strong>
            <span class="first-name">{{ capitalizeName(person.first_name) }}</span>
          </div>
        </div>
      }
    </div>

    @if (totalPages() > 1) {
      <div class="pagination-wrapper">
        <div class="items-per-page">
          <span>Items per page:</span>
          @for (option of itemsPerPageOptions; track option) {
            <button
              type="button"
              class="items-option"
              [class.active]="itemsPerPage() === option"
              (click)="onItemsPerPageChange(option)"
            >
              {{ option }}
            </button>
          }
        </div>
        <div class="pagination">
          <tui-pagination
            [length]="totalPages()"
            [index]="page() - 1"
            (indexChange)="onPageChange($event)"
          />
        </div>
      </div>
    }
  }
</div>

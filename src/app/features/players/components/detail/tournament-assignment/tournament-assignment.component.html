<div class="tournament-assignment">
  <h3 class="tournament-assignment__title">{{ tournamentTitle()?.toUpperCase() || 'N/A' }}</h3>
  
  <div class="tournament-assignment__content">
    <ng-content select="[slot=photo]"></ng-content>

    <div class="tournament-assignment__form-section">
      <div class="tournament-assignment__form-row">
        <label class="tournament-assignment__field-label">Team</label>
        @if (!editingTeam()) {
          <div class="tournament-assignment__field-value">
            <span class="tournament-assignment__value">{{ getTeamName(editedTeamId()) }}</span>
            <button
              type="button"
              class="tournament-assignment__edit-button"
              (click)="startEditTeam()">
              <tui-icon icon="@tui.pencil" />
            </button>
          </div>
        } @else {
          <div class="tournament-assignment__field-edit">
            <tui-textfield
              tuiChevron
              [stringify]="stringifyTeam.bind(this)"
              tuiTextfieldSize="m">
              <label tuiLabel>Select team</label>
              <input
                placeholder="No team"
                tuiComboBox
                [(ngModel)]="editedTeamId"
                [disabled]="tournamentTeamsLoading()" />
              <tui-data-list *tuiTextfieldDropdown>
                @if (tournamentTeamsLoading()) {
                  <div class="tournament-assignment__dropdown-loading">Loading teams...</div>
                } @else if (tournamentTeamsError()) {
                  <div class="tournament-assignment__dropdown-error">{{ tournamentTeamsError() }}</div>
                } @else if (tournamentTeams().length === 0) {
                  <div class="tournament-assignment__dropdown-empty">No teams available</div>
                } @else {
                  <button
                    new
                    tuiOption
                    type="button"
                    [value]="null"
                    class="tournament-assignment__option">
                    No team
                  </button>
                  @for (team of tournamentTeams() | tuiFilterByInput; track team.id) {
                    <button
                      new
                      tuiOption
                      type="button"
                      [value]="team.id"
                      class="tournament-assignment__option">
                      {{ (team.title || 'Team #' + team.id).toUpperCase() }}
                    </button>
                  }
                }
              </tui-data-list>
            </tui-textfield>
            <div class="tournament-assignment__field-actions">
              <button
                type="button"
                class="tournament-assignment__action-button tournament-assignment__save-button"
                (click)="saveTeam()">
                <tui-icon icon="@tui.check" />
              </button>
              <button
                type="button"
                class="tournament-assignment__action-button tournament-assignment__cancel-button"
                (click)="cancelEditTeam()">
                <tui-icon icon="@tui.x" />
              </button>
            </div>
          </div>
        }
      </div>

      <div class="tournament-assignment__form-row">
        <label class="tournament-assignment__field-label">Player Number</label>
        @if (!editingNumber()) {
          <div class="tournament-assignment__field-value">
            <span class="tournament-assignment__value">
              @if (editedPlayerNumber()) {
                #{{ editedPlayerNumber() }}
              } @else {
                No number
              }
            </span>
            <button
              type="button"
              class="tournament-assignment__edit-button"
              (click)="startEditNumber()">
              <tui-icon icon="@tui.pencil" />
            </button>
          </div>
        } @else {
          <div class="tournament-assignment__field-edit">
            <tui-textfield tuiTextfieldSize="m">
              <label tuiLabel>Player number</label>
              <input
                placeholder="#"
                tuiTextfield
                [(ngModel)]="editedPlayerNumber" />
            </tui-textfield>
            <div class="tournament-assignment__field-actions">
              <button
                type="button"
                class="tournament-assignment__action-button tournament-assignment__save-button"
                (click)="saveNumber()">
                <tui-icon icon="@tui.check" />
              </button>
              <button
                type="button"
                class="tournament-assignment__action-button tournament-assignment__cancel-button"
                (click)="cancelEditNumber()">
                <tui-icon icon="@tui.x" />
              </button>
            </div>
          </div>
        }
      </div>

      <div class="tournament-assignment__form-row">
        <label class="tournament-assignment__field-label">Position</label>
        @if (!editingPosition()) {
          <div class="tournament-assignment__field-value">
            <span class="tournament-assignment__value">{{ getPositionName(editedPositionId()) }}</span>
            <button
              type="button"
              class="tournament-assignment__edit-button"
              (click)="startEditPosition()">
              <tui-icon icon="@tui.pencil" />
            </button>
          </div>
        } @else {
          <div class="tournament-assignment__field-edit">
            <tui-textfield
              tuiChevron
              [stringify]="stringifyPosition.bind(this)"
              tuiTextfieldSize="m">
              <label tuiLabel>Select position</label>
              <input
                placeholder="No position"
                tuiComboBox
                [(ngModel)]="editedPositionId"
                [disabled]="sportPositionsLoading()" />
              <tui-data-list *tuiTextfieldDropdown>
                @if (sportPositionsLoading()) {
                  <div class="tournament-assignment__dropdown-loading">Loading positions...</div>
                } @else if (sportPositionsError()) {
                  <div class="tournament-assignment__dropdown-error">{{ sportPositionsError() }}</div>
                } @else if (sportPositions().length === 0) {
                  <div class="tournament-assignment__dropdown-empty">No positions available</div>
                } @else {
                  <button
                    new
                    tuiOption
                    type="button"
                    [value]="null"
                    class="tournament-assignment__option">
                    No position
                  </button>
                  @for (position of sportPositions() | tuiFilterByInput; track position.id) {
                    <button
                      new
                      tuiOption
                      type="button"
                      [value]="position.id"
                      class="tournament-assignment__option">
                      {{ stringifyPosition(position) }}
                    </button>
                  }
                }
              </tui-data-list>
            </tui-textfield>
            <div class="tournament-assignment__field-actions">
              <button
                type="button"
                class="tournament-assignment__action-button tournament-assignment__save-button"
                (click)="savePosition()">
                <tui-icon icon="@tui.check" />
              </button>
              <button
                type="button"
                class="tournament-assignment__action-button tournament-assignment__cancel-button"
                (click)="cancelEditPosition()">
                <tui-icon icon="@tui.x" />
              </button>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</div>

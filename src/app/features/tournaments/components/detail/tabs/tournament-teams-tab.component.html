<div class="tournament-teams-tab">
  <div class="tournament-teams-tab__header-with-actions">
    <div class="tournament-teams-tab__search-container">
      <tui-textfield iconStart="@tui.search">
        <label tuiLabel>Search teams</label>
        <input
          placeholder="Search by name or city..."
          tuiTextfield
          [value]="teamSearchQuery()"
          (input)="onTeamSearchChange($any($event.target).value)"
        />
      </tui-textfield>
      @if (teamSearchQuery()) {
        <button
          type="button"
          tuiButton
          appearance="flat"
          iconStart="@tui.close"
          size="s"
          (click)="clearTeamSearch()"
          class="tournament-teams-tab__search-clear"
        ></button>
      }
    </div>
    <button
      type="button"
      tuiButton
      appearance="flat"
      iconStart="@tui.plus"
      (click)="toggleAddTeamForm()"
      class="tournament-teams-tab__add-button">
      @if (showAddTeamForm()) {
        Cancel
      } @else {
        Add Team
      }
    </button>
  </div>

  @if (showAddTeamForm()) {
    <div class="tournament-teams-tab__add-team-form">
      <div class="tournament-teams-tab__form-row">
        <tui-textfield
          tuiChevron
          iconStart="@tui.search"
          [stringify]="stringifyTeam"
          tuiTextfieldSize="m">
          <label tuiLabel>Select Team</label>
          <input
            placeholder="Search and select team to add..."
            tuiComboBox
            [(ngModel)]="selectedTeam"
            [disabled]="availableTeamsLoading()" />
          <tui-data-list *tuiTextfieldDropdown size="l" class="tournament-teams-tab__dropdown-list">
            @if (availableTeamsLoading()) {
              <div class="tournament-teams-tab__dropdown-loading">Loading teams...</div>
            } @else if (availableTeamsError()) {
              <div class="tournament-teams-tab__dropdown-error">{{ availableTeamsError() }}</div>
            } @else if (availableTeams().length === 0) {
              <div class="tournament-teams-tab__dropdown-empty">No available teams</div>
            } @else {
              @for (team of availableTeams() | tuiFilterByInput; track team.id) {
                <button
                  new
                  tuiOption
                  type="button"
                  [value]="team"
                  class="tournament-teams-tab__team-option">
                  {{ team.title | uppercase }}
                  @if (team.city) {
                    <span class="tournament-teams-tab__team-option-city">({{ team.city | uppercase }})</span>
                  }
                </button>
              }
            }
          </tui-data-list>
        </tui-textfield>
      </div>
      <div class="tournament-teams-tab__form-actions">
        <button
          type="button"
          tuiButton
          appearance="primary"
          (click)="addTeam()"
          [disabled]="!selectedTeam()">
          Add Team
        </button>
        <button
          type="button"
          tuiButton
          appearance="flat"
          (click)="cancelAddTeam()">
          Cancel
        </button>
      </div>
    </div>
  }

  @if (teamsLoading()) {
    <div class="tournament-teams-tab__loading">Loading teams...</div>
  } @else if (teamsError()) {
    <div class="tournament-teams-tab__error">{{ teamsError() }}</div>
  } @else if (teams().length === 0) {
    <p class="tournament-teams-tab__empty-message">No teams found for this tournament</p>
  } @else {
    <div class="tournament-teams-tab__team-list">
      @for (team of filteredTeams(); track team.id) {
        <button
          class="tournament-teams-tab__team-card"
          tuiCardLarge
          tuiCell="l"
          (click)="navigateToTeamDetail(team.id)"
        >
          <div class="tournament-teams-tab__team-icon">
            @if (teamLogoUrl(team); as logoUrl) {
              <img [src]="logoUrl" [alt]="team.title" class="tournament-teams-tab__team-logo" />
            } @else {
              <tui-avatar size="l" [round]="true" class="tournament-teams-tab__team-avatar">
                @if (team.title) {
                  {{ team.title | uppercase }}
                }
              </tui-avatar>
            }
          </div>
          <div class="tournament-teams-tab__team-content">
            <h3 class="tournament-teams-tab__team-title">{{ team.title | uppercase }}</h3>
            @if (team.city) {
              <p class="tournament-teams-tab__team-city">{{ team.city | uppercase }}</p>
            }
          </div>
        </button>
      }
    </div>
  }
</div>

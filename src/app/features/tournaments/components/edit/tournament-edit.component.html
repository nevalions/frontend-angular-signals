<div class="tournament-edit">
  <header class="tournament-edit__header">
    <h1 class="tournament-edit__title">Edit Tournament</h1>
    <div class="tournament-edit__context">
      <span>{{ sport?.title }}</span>
      <span>›</span>
      <span>{{ season?.year }}</span>
    </div>
    <div class="tournament-edit__actions">
      <button tuiButton type="button" (click)="cancel()">Cancel</button>
      <button tuiButton type="button" (click)="onSubmit()" [disabled]="tournamentForm.invalid">Save Changes</button>
    </div>
  </header>

  @if (this.loading()) {
    <div class="tournament-edit__loading">Loading tournament...</div>
  }

  @if (tournament) {
    <form class="tournament-edit__form" [formGroup]="tournamentForm">
      <div class="tournament-edit__field">
        <label for="title" class="tournament-edit__label">Title *</label>
        <input
          id="title"
          type="text"
          formControlName="title"
          class="tournament-edit__input"
          [class.tournament-edit__input--invalid]="tournamentForm.controls.title.touched && tournamentForm.controls.title.invalid"
        />
        @if (tournamentForm.controls.title.touched && tournamentForm.controls.title.invalid) {
          @if (tournamentForm.controls.title.errors?.['required']) {
            <div class="tournament-edit__error">Title is required</div>
          }
        }
      </div>

      <div class="tournament-edit__field">
        <label for="description" class="tournament-edit__label">Description</label>
        <textarea
          id="description"
          formControlName="description"
          class="tournament-edit__textarea"
          rows="4"
          placeholder="Enter a description for tournament (optional)"
        ></textarea>
      </div>

      <div class="tournament-edit__field">
        <label for="tournament_eesl_id" class="tournament-edit__label">EESL ID</label>
        <input
          id="tournament_eesl_id"
          type="number"
          formControlName="tournament_eesl_id"
          class="tournament-edit__input"
        />
      </div>

      <div class="tournament-edit__field">
        <label class="tournament-edit__label">Main Sponsor</label>
        <tui-textfield tuiChevron [content]="sponsorContent" [stringify]="sponsorStringify">
          <input
            placeholder="Select Main Sponsor (optional)"
            tuiSelect
            formControlName="main_sponsor_id"
          />
          <tui-data-list *tuiTextfieldDropdown size="l">
            @for (sponsor of sponsors(); track sponsor.id) {
              <button new tuiOption type="button" [value]="sponsor.id" class="tournament-edit__sponsor-option">{{ formatTitle(sponsor.title) }}</button>
            }
          </tui-data-list>
        </tui-textfield>
      </div>

      <div class="tournament-edit__field">
        <label class="tournament-edit__label">Sponsor Line</label>
        <tui-textfield tuiChevron [content]="sponsorLineContent" [stringify]="sponsorLineStringify">
          <input
            placeholder="Select Sponsor Line (optional)"
            tuiSelect
            formControlName="sponsor_line_id"
          />
          <tui-data-list *tuiTextfieldDropdown size="l">
            @for (line of sponsorLines(); track line.id) {
              <button new tuiOption type="button" [value]="line.id" class="tournament-edit__sponsor-line-option">{{ formatTitle(line.title) }}</button>
            }
          </tui-data-list>
        </tui-textfield>
      </div>

      <div class="tournament-edit__field">
        <app-image-upload
          label="Logo"
          mode="three-size"
          [currentUrls]="displayLogoUrls()"
          [uploading]="logoUploadLoading()"
          (upload)="onLogoUpload($event)"
          (remove)="onLogoRemove()"
        />
      </div>

      <div class="tournament-edit__section tournament-edit__section--warning">
        <h2 class="tournament-edit__section-title">Move Tournament to Another Sport</h2>
        <p class="tournament-edit__warning-text">
          ⚠️ Moving this tournament will also move all associated teams, players, matches, and statistics to the new sport.
        </p>
        <form class="tournament-edit__move-form" [formGroup]="moveSportForm">
          <div class="tournament-edit__field">
            <label for="target_sport_id" class="tournament-edit__label">Target Sport</label>
            <select
              id="target_sport_id"
              formControlName="target_sport_id"
              class="tournament-edit__select"
            >
              <option [value]="null">Select a sport...</option>
              @for (sport of availableSports(); track sport.id) {
                <option [value]="sport.id">{{ sport.title }}</option>
              }
            </select>
          </div>
          <div class="tournament-edit__actions tournament-edit__actions--move">
            <button
              tuiButton
              type="button"
              (click)="onMoveToSport()"
              [disabled]="moveSportForm.invalid"
              class="tournament-edit__button--move"
            >
              Move Tournament
            </button>
          </div>
        </form>
      </div>
    </form>
  } @else {
    <div class="tournament-edit__not-found">Tournament not found</div>
  }
</div>
